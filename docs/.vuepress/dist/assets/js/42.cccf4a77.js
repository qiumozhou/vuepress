(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{541:function(s,n,a){"use strict";a.r(n);var e=a(29),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_01、拷贝代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01、拷贝代码"}},[s._v("#")]),s._v(" 01、拷贝代码")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\'\'\'\n@File :server.py\n@Date :2022/3/26\n@Author :QiuMozhou\n@MAIL  :15717163552@163.com\n\'\'\'\nimport time\nimport imaplib, email, os\nimport datetime\nfrom email.header import decode_header\n# 添加缺失的命令\nimaplib.Commands[\'ID\'] = (\'AUTH\')\n\nclass IMAP_Downemail(object):\n    """\n    """\n    def __init__(self, account, pwd, serverurl, savedir, startdate, enddate, exts=[\'.xls\', \'.xlsx\']):\n        """\n        init\n        :param account:   邮箱账户\n        :param pwd:       密码\n        :param serverurl: 接收服务器地址\n        :param savedir:   文件保存路径\n        :param startdate: 邮件开始日期\n        :param enddate:   邮件结束日期\n        :param exts:      附件拓展名\n        """\n        self._account = account\n        self._pwd = pwd\n        self._serverurl = serverurl\n        self._savedir = savedir\n        self._startdate = startdate\n        self._enddate = enddate\n        self._exts = exts\n\n    def __getEmailattachment(self, msg):\n        """\n        下载邮件中的附件\n        """\n        attachments = []\n        for part in msg.walk():\n            if part.get_content_maintype() == \'multipart\':\n                continue\n            if part.get(\'Content-Disposition\') is None:\n                continue\n            fileName = part.get_filename()\n\n            # 如果文件名为纯数字、字母时不需要解码，否则需要解码\n            try:\n                fileName = decode_header(fileName)[0][0].decode(decode_header(fileName)[0][1])\n            except:\n                pass\n\n            # 只获取指定拓展名的附件\n            extension = os.path.splitext(os.path.split(fileName)[1])[1]\n            if extension not in self._exts:\n                continue\n\n            # 如果获取到了文件，则将文件保存在指定的目录下\n            if fileName:\n                if not os.path.exists(self._savedir):\n                    os.makedirs(self._savedir)\n                filePath = os.path.join(self._savedir, fileName)\n                fp = open(filePath, \'wb\')\n                fp.write(part.get_payload(decode=True))\n                fp.close()\n                attachments.append(fileName)\n\n        return attachments\n\n    def scanDown(self, process_fun=None):\n        if process_fun:\n            process_fun("当前邮箱：{}".format(self._account))\n\n        # 连接到qq企业邮箱，其他邮箱调整括号里的参数\n        conn = imaplib.IMAP4_SSL(self._serverurl, 993)\n\n        if process_fun:\n            process_fun("身份认证...")\n        try:\n            # 用户名、密码，登陆\n            conn.login(self._account, self._pwd)\n            login_success = True\n        except:\n            login_success = False\n\n        if login_success:\n            if process_fun:\n                process_fun("邮箱{}登录成功！".format(self._account))\n\n            # 选定一个邮件文件夹\n            # 收件箱默认名称是"INBOX"\n            # 可以用conn.list()查看都有哪些文件夹\n            print(conn.list())\n\n            args = ("name", "qmz", "contact", "15717163552@163.com", "version", "1.0.0", "vendor", "myclient")\n            conn._simple_command(\'ID\', \'("\' + \'" "\'.join(args) + \'")\')\n\n            conn.select(\'INBOX\')\n\n            # 提取文件夹中所有邮件的编号\n            resp, mails = conn.search(None, "(UNSEEN)")\n\n            # 邮件编号列表\n            msgList = mails[0].split()\n\n            # 从最近的邮件开始获取\n            for i in reversed(range(len(msgList))):\n                try:\n                    resp, data = conn.fetch(msgList[i], \'(RFC822)\')\n                    emailbody = data[0][1]\n                    mail = email.message_from_bytes(emailbody)\n\n                    # 解析邮件日期\n                    try:\n                        mail_date = time.strptime(mail.get("Date")[0:24], \'%a, %d %b %Y %H:%M:%S\')  # 格式化收件时间\n                    except:\n                        mail_date = time.strptime(mail.get("Date"), \'%d %b %Y %H:%M:%S +0800\')  # 格式化收件时间\n                    mail_date = time.strftime("%Y%m%d", mail_date)\n\n                    startdate = self._startdate\n                    stopdate = self._enddate\n\n                    if mail_date == (datetime.datetime.strptime(startdate, \'%Y%m%d\') - datetime.timedelta(days=1)).strftime(\'%Y%m%d\'):\n                        break\n\n                    if mail_date == (datetime.datetime.strptime(startdate, \'%Y%m%d\') - datetime.timedelta(days=3)).strftime(\'%Y%m%d\'):\n                        break\n\n                    if (mail_date < startdate) | (mail_date > stopdate):\n                        continue\n\n                    # 获取附件\n                    attachments = self.__getEmailattachment(mail)\n                    for attachment in attachments:\n                        if process_fun:\n                            process_fun("已下载文件：{}".format(attachment))\n                except:\n                    continue\n\n            conn.close()\n            conn.logout()\n        else:\n            if process_fun:\n                process_fun("邮箱{}登录失败！".format(self._account))\n\nif __name__ == \'__main__\':\n    def process_msg(msg):\n        print(msg)\n\n    # 邮箱账号列表\n    account_list = [\n        {\n            "email": "15717163552@163.com",  # 邮箱\n            "password": "12345",  # 授权密码\n            "server": "imap.163.com"  # 服务器地址\n        }\n    ]\n\n    # 文件保存目录\n    _dir = r"./test2"\n\n    # 邮件开始日期和结束日期\n    startdate = "20220129"\n    enddate = "20220429"\n\n    # 下载\n    for account in account_list:\n        _email = account[\'email\']\n        _password = account[\'password\']\n        _server = account[\'server\']\n        etool = IMAP_Downemail(_email, _password, _server, _dir, startdate, enddate)\n        etool.scanDown(process_msg)\n\n    print(\'Done.\')\n\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br"),a("span",{staticClass:"line-number"},[s._v("161")]),a("br"),a("span",{staticClass:"line-number"},[s._v("162")]),a("br"),a("span",{staticClass:"line-number"},[s._v("163")]),a("br"),a("span",{staticClass:"line-number"},[s._v("164")]),a("br"),a("span",{staticClass:"line-number"},[s._v("165")]),a("br"),a("span",{staticClass:"line-number"},[s._v("166")]),a("br"),a("span",{staticClass:"line-number"},[s._v("167")]),a("br"),a("span",{staticClass:"line-number"},[s._v("168")]),a("br"),a("span",{staticClass:"line-number"},[s._v("169")]),a("br"),a("span",{staticClass:"line-number"},[s._v("170")]),a("br"),a("span",{staticClass:"line-number"},[s._v("171")]),a("br"),a("span",{staticClass:"line-number"},[s._v("172")]),a("br"),a("span",{staticClass:"line-number"},[s._v("173")]),a("br"),a("span",{staticClass:"line-number"},[s._v("174")]),a("br"),a("span",{staticClass:"line-number"},[s._v("175")]),a("br"),a("span",{staticClass:"line-number"},[s._v("176")]),a("br"),a("span",{staticClass:"line-number"},[s._v("177")]),a("br")])]),a("h3",{attrs:{id:"_02、运行服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02、运行服务"}},[s._v("#")]),s._v(" 02、运行服务")]),s._v(" "),a("p",[s._v("执行"),a("code",[s._v("python main.py")])])])}),[],!1,null,null,null);n.default=t.exports}}]);