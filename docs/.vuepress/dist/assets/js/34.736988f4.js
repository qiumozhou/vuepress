(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{534:function(s,n,e){"use strict";e.r(n);var a=e(29),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"_01、拷贝代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_01、拷贝代码"}},[s._v("#")]),s._v(" 01、拷贝代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("'''\n@File :main.py\n@Date :2022/3/26\n@Author :QiuMozhou\n@MAIL  :15717163552@163.com\n'''\n# -*- coding: utf-8 -*-\nimport poplib,email,telnetlib\nimport datetime,time\nfrom email.parser import Parser\nfrom email.header import decode_header\nfrom email.utils import parseaddr\n\n\nclass down_email():\n\n    def __init__(self,user,password,eamil_server):\n        # 输入邮件地址, 口令和POP3服务器地址:\n        self.user = user\n        # 此处密码是授权码,用于登录第三方邮件客户端\n        self.password = password\n        self.pop3_server = eamil_server\n\n    # 获得msg的编码\n    def guess_charset(self,msg):\n        charset = msg.get_charset()\n        if charset is None:\n            content_type = msg.get('Content-Type', '').lower()\n            pos = content_type.find('charset=')\n            if pos >= 0:\n                charset = content_type[pos + 8:].strip()\n        return charset\n\n    #获取邮件内容\n    def get_content(self,msg):\n        content=''\n        content_type = msg.get_content_type()\n        # print('content_type:',content_type)\n        if content_type == 'text/plain': # or content_type == 'text/html'\n            content = msg.get_payload(decode=True)\n            charset = self.guess_charset(msg)\n            if charset:\n                content = content.decode(charset)\n        return content\n\n    # 字符编码转换\n    # @staticmethod\n    def decode_str(self,str_in):\n        value, charset = decode_header(str_in)[0]\n        if charset:\n            value = value.decode(charset)\n        return value\n\n    # 解析邮件,获取附件\n    def get_att(self,msg_in, str_day):\n        attachment_files = []\n        for part in msg_in.walk():\n            # 获取附件名称类型\n            file_name = part.get_param(\"name\")  # 如果是附件，这里就会取出附件的文件名\n            # file_name = part.get_filename() #获取file_name的第2中方法\n            # contType = part.get_content_type()\n            if file_name:\n                h = email.header.Header(file_name)\n                # 对附件名称进行解码\n                dh = email.header.decode_header(h)\n                filename = dh[0][0]\n                if dh[0][1]:\n                    # 将附件名称可读化\n                    filename = self.decode_str(str(filename, dh[0][1]))\n                    # print(filename)\n                    # filename = filename.encode(\"utf-8\")\n                # 下载附件\n                data = part.get_payload(decode=True)\n                # 在指定目录下创建文件，注意二进制文件需要用wb模式打开\n                att_file = open('./test/' + filename, 'wb')\n                att_file.write(data)  # 保存附件\n                att_file.close()\n                attachment_files.append(filename)\n            else:\n                # 不是附件，是文本内容\n                print(self.get_content(part))\n                # # 如果ture的话内容是没用的\n                # if not part.is_multipart():\n                #     # 解码出文本内容，直接输出来就可以了。\n                #     print(part.get_payload(decode=True).decode('utf-8'))\n\n        return attachment_files\n\n    def run_ing(self):\n        str_day = str(datetime.date.today())# 日期赋值\n        # 连接到POP3服务器,有些邮箱服务器需要ssl加密，可以使用poplib.POP3_SSL\n        try:\n            telnetlib.Telnet(self.pop3_server, 995)\n            self.server = poplib.POP3_SSL(self.pop3_server, 995, timeout=10)\n        except:\n            time.sleep(5)\n            self.server = poplib.POP3(self.pop3_server, 110, timeout=10)\n\n        # server.set_debuglevel(1) # 可以打开或关闭调试信息\n        # 打印POP3服务器的欢迎文字:\n        print(self.server.getwelcome().decode('utf-8'))\n        # 身份认证:\n        self.server.user(self.user)\n        self.server.pass_(self.password)\n        # 返回邮件数量和占用空间:\n        print(\"**********\",dir(self.server))\n        print('Messages: %s. Size: %s' % self.server.stat())\n\n        # list()返回所有邮件的编号:\n        while True:\n            time.sleep(5)\n            self.server.noop()\n            resp, mails, octets = self.server.list()\n            # 可以查看返回的列表类似[b'1 82923', b'2 2184', ...]\n            print(mails)\n            index = len(mails)\n            for i in range(index, index-1, -1):# 倒序遍历邮件\n            # for i in range(1, index + 1):# 顺序遍历邮件\n                resp, lines, octets = self.server.retr(i)\n                # lines存储了邮件的原始文本的每一行,\n                # 邮件的原始文本:\n                msg_content = b'\\r\\n'.join(lines).decode('utf-8')\n                # 解析邮件:\n                msg = Parser().parsestr(msg_content)\n                #获取邮件的发件人，收件人， 抄送人,主题\n                # hdr, addr = parseaddr(msg.get('From'))\n                # From = self.decode_str(hdr)\n                # hdr, addr = parseaddr(msg.get('To'))\n                # To = self.decode_str(hdr)\n                # 方法2：from or Form均可\n                From = parseaddr(msg.get('from'))[1]\n                To = parseaddr(msg.get('To'))[1]\n                Cc=parseaddr(msg.get_all('Cc'))[1]# 抄送人\n                #邮件名称\n                Subject = self.decode_str(msg.get('Subject'))\n                print('from:%s,to:%s,Cc:%s,subject:%s'%(From,To,Cc,Subject))\n                # 获取邮件时间,格式化收件时间\n                date1 = time.strptime(msg.get(\"Date\")[0:24], '%a, %d %b %Y %H:%M:%S')\n\n                # 邮件时间格式转换\n                date2 = time.strftime(\"%Y-%m-%d %H:%M:%S\",date1)\n                print(\"邮件时间:\" + date2)\n                if date2 < str_day:\n                    break # 倒叙用break\n                    # continue # 顺叙用continue\n                else:\n                    # 获取附件\n                    attach_file=self.get_att(msg,str_day)\n                    print(attach_file)\n\n            # 可以根据邮件索引号直接从服务器删除邮件:\n            # self.server.dele(7)\n\n\n\nif __name__ == '__main__':\n    #把打印内容输出到文件\n    try:\n        # 输入邮件地址, 口令和POP3服务器地址:\n        user = '15717163552@163.com'\n        # 此处密码是授权码,用于登录第三方邮件客户端\n        password = '12314'\n        eamil_server = 'pop.163.com'\n        email_class=down_email(user=user,password=password,eamil_server=eamil_server)\n        email_class.run_ing()\n    except Exception as e:\n        import traceback\n        ex_msg = '{exception}'.format(exception=traceback.format_exc())\n        print(ex_msg)\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br"),e("span",{staticClass:"line-number"},[s._v("140")]),e("br"),e("span",{staticClass:"line-number"},[s._v("141")]),e("br"),e("span",{staticClass:"line-number"},[s._v("142")]),e("br"),e("span",{staticClass:"line-number"},[s._v("143")]),e("br"),e("span",{staticClass:"line-number"},[s._v("144")]),e("br"),e("span",{staticClass:"line-number"},[s._v("145")]),e("br"),e("span",{staticClass:"line-number"},[s._v("146")]),e("br"),e("span",{staticClass:"line-number"},[s._v("147")]),e("br"),e("span",{staticClass:"line-number"},[s._v("148")]),e("br"),e("span",{staticClass:"line-number"},[s._v("149")]),e("br"),e("span",{staticClass:"line-number"},[s._v("150")]),e("br"),e("span",{staticClass:"line-number"},[s._v("151")]),e("br"),e("span",{staticClass:"line-number"},[s._v("152")]),e("br"),e("span",{staticClass:"line-number"},[s._v("153")]),e("br"),e("span",{staticClass:"line-number"},[s._v("154")]),e("br"),e("span",{staticClass:"line-number"},[s._v("155")]),e("br"),e("span",{staticClass:"line-number"},[s._v("156")]),e("br"),e("span",{staticClass:"line-number"},[s._v("157")]),e("br"),e("span",{staticClass:"line-number"},[s._v("158")]),e("br"),e("span",{staticClass:"line-number"},[s._v("159")]),e("br"),e("span",{staticClass:"line-number"},[s._v("160")]),e("br"),e("span",{staticClass:"line-number"},[s._v("161")]),e("br"),e("span",{staticClass:"line-number"},[s._v("162")]),e("br"),e("span",{staticClass:"line-number"},[s._v("163")]),e("br"),e("span",{staticClass:"line-number"},[s._v("164")]),e("br"),e("span",{staticClass:"line-number"},[s._v("165")]),e("br"),e("span",{staticClass:"line-number"},[s._v("166")]),e("br"),e("span",{staticClass:"line-number"},[s._v("167")]),e("br"),e("span",{staticClass:"line-number"},[s._v("168")]),e("br"),e("span",{staticClass:"line-number"},[s._v("169")]),e("br")])]),e("h3",{attrs:{id:"_02、运行服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_02、运行服务"}},[s._v("#")]),s._v(" 02、运行服务")]),s._v(" "),e("p",[s._v("执行"),e("code",[s._v("python main.py")])])])}),[],!1,null,null,null);n.default=t.exports}}]);